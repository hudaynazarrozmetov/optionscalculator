<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Profit & Loss Calculator</title>
    <style>
        :root {
            --color-bg-base: #0f172a;
            --color-bg-surface: #1e293b;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-primary: #38bdf8;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-border: rgba(148, 163, 184, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-bg-base);
            color: var(--color-text-primary);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 28px;
            color: var(--color-primary);
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .card {
            background: var(--color-bg-surface);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--color-border);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px;
            background: var(--color-bg-base);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text-primary);
            font-size: 16px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .result-box {
            background: var(--color-bg-base);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .result-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .result-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .result-value.success {
            color: var(--color-success);
        }

        .result-value.danger {
            color: var(--color-danger);
        }

        .targets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .target-card {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 16px;
        }

        .target-title {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .target-profit {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-success);
            margin-bottom: 4px;
        }

        .target-points {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        button {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: var(--color-bg-base);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        .risk-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .risk-conservative {
            background: rgba(16, 185, 129, 0.2);
            color: var(--color-success);
        }

        .risk-moderate {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .risk-aggressive {
            background: rgba(239, 68, 68, 0.2);
            color: var(--color-danger);
        }

        @media (max-width: 600px) {
            .row {
                grid-template-columns: 1fr;
            }
        }

        /* small red warning under Contracts */
        .warning-text {
            font-size: 12px;
            color: var(--color-danger);
            margin-top: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 style="font-size: 36px; font-weight: 700; margin-bottom: 8px;">Nazar Trades</h1>
            <p style="font-size: 18px; color: var(--color-text-secondary); margin-bottom: 20px;">Options Profit & Loss Calculator</p>
        </header>

        <div class="card">
            <h2 style="margin-bottom: 20px; font-size: 18px;">Position Setup</h2>
            
            <div class="row">
                <div class="input-group">
                    <label for="account">Account Size ($)</label>
                    <input
                        type="text"
                        id="account"
                        inputmode="decimal"
                        placeholder="0"
                        oninput="handleAccountInput(this); clampContractsToAccount();"
                        onblur="formatAccountOnBlur(this); clampContractsToAccount();"
                    >
                </div>
                
                <div class="input-group">
                    <label for="risk">Risk Per Trade (%)</label>
                    <input
                        type="number"
                        id="risk"
                        step="0.1"
                        min="1"
                        max="100"
                        placeholder="0"
                        oninput="clampPercentInput(this)"
                    >
                </div>
            </div>

            <div class="input-group">
                <label for="optionType">Option Type</label>
                <select id="optionType">
                    <option value="call">Call Option</option>
                    <option value="put">Put Option</option>
                </select>
            </div>

            <div class="row">
                <div class="input-group">
                    <label for="entryPrice">Entry Price (per contract) ($)</label>
                    <input
                        type="number"
                        id="entryPrice"
                        inputmode="decimal"
                        step="0.01"
                        min="0"
                        placeholder="0.00"
                        oninput="clampContractsToAccount();"
                    >
                </div>
                
                <div class="input-group">
                    <label for="contracts">Contracts</label>
                    <input
                        type="text"
                        id="contracts"
                        inputmode="numeric"
                        placeholder="0"
                        oninput="handleContractsInput(this)"
                    >
                    <div id="contractsWarning" class="warning-text">
                        Account size is reached.
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="input-group">
                    <label for="commissionPerContract">Commission (per contract, round-trip) ($)</label>
                    <input type="number" id="commissionPerContract" inputmode="decimal" step="0.01" min="0" placeholder="0.00">
                </div>

                <div class="input-group"></div>
            </div>

            <div class="row">
                <div class="input-group">
                    <label for="stopLossPercent">Stop Loss (%)</label>
                    <input
                        type="number"
                        id="stopLossPercent"
                        step="1"
                        min="1"
                        max="100"
                        placeholder="0"
                        oninput="clampPercentInput(this)"
                    >
                </div>
                
                <div class="input-group">
                    <label for="target1Percent">Take Profit (%)</label>
                    <input
                        type="number"
                        id="target1Percent"
                        step="1"
                        min="1"
                        max="100"
                        placeholder="0"
                        oninput="clampPercentInput(this)"
                    >
                </div>
            </div>

            <button onclick="calculate()">Calculate</button>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 20px; font-size: 18px;">Position & Risk</h2>
            
            <div class="results-grid">
                <div class="result-box">
                    <div class="result-label">Stop Loss Price</div>
                    <div class="result-value danger" id="stopLossPrice">$0.00</div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Take Profit Price</div>
                    <div class="result-value success" id="target1Price">$0.00</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 20px; font-size: 18px;">Profit Targets</h2>
            
            <div class="results-grid">
                <div class="result-box">
                    <div class="result-label">Risk Amount</div>
                    <div class="result-value danger" id="riskAmount">$0.00</div>
                </div>
            </div>

            <div class="targets" id="targetsContainer">
                <div class="target-card">
                    <div class="target-title">Take Profit</div>
                    <div class="target-profit" id="takeProfitCardValue">$0.00</div>
                </div>
            </div>
        </div>

        <div class="card" style="background: rgba(56, 189, 248, 0.05);">
            <h3 style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 12px;">Note</h3>
            <p style="font-size: 13px; color: var(--color-text-secondary);">
                Each options contract represents 100 shares. Risk per contract is based on the difference between entry and stop price times 100. 
                Commissions reduce your net profit per contract. Always verify calculations and manage risk according to your trading plan.
            </p>
        </div>
    </div>

    <script>
        // ---------- helpers ----------
        function parseNumber(value) {
            const clean = value.toString().replace(/,/g, '');
            const num = parseFloat(clean);
            return isNaN(num) ? 0 : num;
        }

        function formatMoney(num) {
            return '$' + num.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatWithCommas(num) {
            return num.toLocaleString('en-US');
        }

        function clampPercentInput(input) {
            let val = parseNumber(input.value);
            if (!val) {
                input.value = '';
                return;
            }
            if (val < 1) val = 1;
            if (val > 100) val = 100;
            input.value = val;
        }

        // ---------- Account Size formatting ----------
        function handleAccountInput(input) {
            let value = input.value.replace(/[^\d.]/g, '');

            if (value.startsWith('-')) {
                value = value.slice(1);
            }

            const parts = value.split('.');
            let whole = parts[0];
            let decimal = parts[1] || '';

            if (whole) {
                whole = parseInt(whole, 10).toLocaleString('en-US');
            } else {
                whole = '';
            }

            input.value = decimal ? `${whole}.${decimal}` : whole;
        }

        function formatAccountOnBlur(input) {
            const num = parseNumber(input.value);
            if (!num) {
                input.value = '';
                return;
            }
            input.value = num.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
        }

        // ---------- Contracts vs Account Size ----------
        function getMaxContractsByAccount() {
            const accountSize = parseNumber(document.getElementById('account').value);
            const entryPrice = parseNumber(document.getElementById('entryPrice').value);

            if (!accountSize || !entryPrice) return Infinity;

            // max dollars in position = accountSize
            // cost per contract = entryPrice * 100
            const costPerContract = entryPrice * 100;
            if (costPerContract <= 0) return Infinity;

            const maxContracts = Math.floor(accountSize / costPerContract);
            return Math.max(0, maxContracts);
        }

        function showContractsWarning(show) {
            const warningEl = document.getElementById('contractsWarning');
            warningEl.style.display = show ? 'block' : 'none';
        }

        function clampContractsToAccount() {
            const contractsInput = document.getElementById('contracts');
            let val = parseNumber(contractsInput.value);
            const maxContracts = getMaxContractsByAccount();

            if (!isFinite(maxContracts)) {
                showContractsWarning(false);
                return;
            }

            let changed = false;

            if (val > maxContracts) {
                val = maxContracts;
                changed = true;
            }
            if (val < 0) {
                val = 0;
                changed = true;
            }

            if (val === 0) {
                contractsInput.value = '';
            } else {
                contractsInput.value = formatWithCommas(val);
            }

            showContractsWarning(changed && val > 0);
        }

        function handleContractsInput(input) {
            let raw = input.value.replace(/[^\d]/g, '');
            if (!raw) {
                input.value = '';
                showContractsWarning(false);
                return;
            }

            let val = parseInt(raw, 10);
            const maxContracts = getMaxContractsByAccount();

            let exceeded = false;

            if (isFinite(maxContracts) && val > maxContracts) {
                val = maxContracts;
                exceeded = true;
            }

            if (val < 0) val = 0;

            if (val === 0) {
                input.value = '';
            } else {
                input.value = formatWithCommas(val);
            }

            showContractsWarning(exceeded && val > 0);
        }

        // ---------- main calc ----------
        function calculate() {
            const optionType = document.getElementById('optionType').value;

            const entryPrice = parseNumber(document.getElementById('entryPrice').value);
            const contracts = parseNumber(document.getElementById('contracts').value);

            const stopLossPercent = parseNumber(document.getElementById('stopLossPercent').value);
            const target1Percent = parseNumber(document.getElementById('target1Percent').value);
            const commissionPerContract = parseNumber(document.getElementById('commissionPerContract').value);

            const riskAmountEl = document.getElementById('riskAmount');
            const stopLossPriceEl = document.getElementById('stopLossPrice');
            const target1PriceEl = document.getElementById('target1Price');
            const takeProfitCardValueEl = document.getElementById('takeProfitCardValue');

            if (!entryPrice || !contracts) {
                riskAmountEl.textContent = '$0.00';
                stopLossPriceEl.textContent = '$0.00';
                target1PriceEl.textContent = '$0.00';
                takeProfitCardValueEl.textContent = '$0.00';
                return;
            }

            const multiplier = 100;

            let stopLoss, target1;

            if (optionType === 'call') {
                stopLoss = stopLossPercent > 0 ? entryPrice * (1 - stopLossPercent / 100) : entryPrice;
                target1 = target1Percent > 0 ? entryPrice * (1 + target1Percent / 100) : entryPrice;
            } else {
                stopLoss = stopLossPercent > 0 ? entryPrice * (1 + stopLossPercent / 100) : entryPrice;
                target1 = target1Percent > 0 ? entryPrice * (1 - target1Percent / 100) : entryPrice;
            }

            const riskPerContract = Math.abs(entryPrice - stopLoss) * multiplier;
            const totalRisk = contracts * riskPerContract;

            riskAmountEl.textContent = formatMoney(totalRisk);
            stopLossPriceEl.textContent = formatMoney(stopLoss);
            target1PriceEl.textContent = formatMoney(target1);

            const grossProfitPerContract = Math.abs(target1 - entryPrice) * multiplier;
            const netProfitPerContract = grossProfitPerContract - commissionPerContract;
            const totalNetProfit = contracts * netProfitPerContract;

            takeProfitCardValueEl.textContent = formatMoney(totalNetProfit);
        }
    </script>
</body>
</html>
